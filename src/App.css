/* === RESPONSIVE SETUP & CSS VARIABLES === */
:root {
  /* Core Colors (Unchanged from your original) */
  --square-bg: #2d2d2d;
  --square-border: #444;
  --background-color: #1a1a1a;
  --text-color: #f0f0f0;
  --text-muted: #aaa;

  --blue: #377dff;
  --yellow: #ffc107;
  --green: #2bcded;
  --purple: #9d37ff;
  --red: #dc3545;
  --orange: #fd7e14;
  --cyan: #0dcaf0;
  --action-green: #198754;

  /* --- RESPONSIVE SIZING VARIABLES --- */
  /* The size of one square on the board, based on the smaller viewport dimension */
  --square-size: 8vmin;
  /* The gap between squares, proportional to the square size */
  --gap-size: calc(var(--square-size) / 12);
}

html {
  /* Set a base font size for rem calculations. We will adjust this in media queries. */
  font-size: 16px;
}

body {
  background-color: var(--background-color);
  color: var(--text-color);
  font-family: 'Poppins', sans-serif;
  margin: 0;
  padding: 1rem; /* Use a smaller base padding */
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  box-sizing: border-box;
}

/* === SCREEN STYLES (Home, Settings, End) - Made Responsive === */
.screen {
  padding: 2rem;
  border-radius: 16px;
  width: 100%;
  max-width: 600px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.screen h2 {
  margin: 0;
  font-size: 2.2rem;
}

/* --- Home Screen --- */
.mode-selection {
  display: flex;
  justify-content: center;
  gap: 1rem;
}

.mode-selection button {
  font-family: 'Poppins', sans-serif;
  font-weight: 600;
  font-size: 1.2rem;
  padding: 0.8rem 1.5rem;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background-color: var(--blue);
  color: white;
  transition: all 0.2s ease;
}

.mode-selection button:hover {
  transform: translateY(-4px);
  filter: brightness(1.1);
  box-shadow: 0 8px 15px rgba(0,0,0,0.4);
}

.home-buttons {
    margin-top: 1rem;
    border-top: 1px solid var(--square-border);
    padding-top: 1.5rem;
    width: 100%;
}
.home-buttons button.secondary {
    background-color: var(--square-bg);
    color: var(--text-muted);
    font-size: 1rem;
    padding: 0.8rem 1.5rem;
}

/* --- End Screen --- */
.end-screen h3 { margin: -1rem 0 0 0; font-size: 1.4rem; color: var(--yellow); }
.scoreboard { width: 100%; display: flex; flex-direction: column; gap: 0.8rem; background-color: rgba(0,0,0,0.2); padding: 1.2rem; border-radius: 12px; }
.score-row { display: grid; grid-template-columns: 40px 1fr auto; align-items: center; font-size: 1.1rem; text-align: left; }
.score-row .rank { font-weight: 700; color: var(--text-muted); }
.score-row .name { font-weight: 600; }
.score-row .score { font-weight: 700; font-size: 1.2rem; }
.end-buttons { display: flex; justify-content: center; gap: 1rem; }
.end-buttons button { font-size: 1rem; padding: 0.8rem 1.2rem; border: none; border-radius: 8px; cursor: pointer; background-color: var(--green); color: white; }

/* --- Settings Screen --- */
.settings-list { flex-direction: column; gap: 1rem; width: 100%; text-align: left; }
.setting-row { display: flex; justify-content: space-between; align-items: center; background-color: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; flex-wrap: wrap; gap: 1rem; }
.setting-row label { font-size: 1.1rem; font-weight: 600; }
.toggle-switch { display: flex; background-color: var(--board-bg); border-radius: 8px; padding: 4px; }
.toggle-switch button { font-size: 0.8rem; padding: 0.5rem 1rem; border: none; border-radius: 6px; background-color: transparent; color: var(--text-muted); cursor: pointer; }
.toggle-switch button.active { background-color: var(--blue); color: white; }
.settings-buttons button { font-size: 1rem; padding: 0.8rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; background-color: var(--green); color: white; }

/* === MAIN LAYOUT & TITLE - Made Responsive === */
.app-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.5rem;
  width: 100%;
  height: 100%;
}

h1 {
  font-size: clamp(1.8rem, 5vw, 3rem); /* Responsive font size */
  font-weight: 700;
  color: var(--cyan);
  text-shadow: 0 0 10px rgba(13, 202, 240, 0.5);
  margin: 0;
  text-align: center;
}

/* === BOARD STYLES - Made Responsive === */
.board {
  display: grid;
  grid-template-columns: repeat(9, var(--square-size));
  grid-template-rows: repeat(9, var(--square-size));
  gap: var(--gap-size);
  padding: calc(var(--gap-size) * 2);
  border-radius: 16px;
  position: relative;
  aspect-ratio: 1 / 1;
}

/* === SQUARE TYPE STYLES - ORDER AND LOGIC PRESERVED FROM ORIGINAL === */
.square.playable[class*="safezone-"] {
  outline-width: 2px;
  outline-style: solid;
}
.playable.safezone-blue { outline-color: var(--blue); }
.playable.safezone-yellow { outline-color: var(--yellow); }
.playable.safezone-green { outline-color: var(--green); }
.playable.safezone-purple { outline-color: var(--purple); }
.playable.wicket { background-color: var(--red); }
.playable.extra { background-color: var(--orange); }
.playable.runs { background-color: var(--cyan); }
.playable.dotball { background-color: #6c757d; }

.square.playable {
  background-color: var(--square-bg);
  border: 1px solid var(--square-border);
  border-radius: 8px;
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
}

.square-content {
  position: absolute;
  font-size: calc(var(--square-size) * 0.35); /* Responsive font */
  font-weight: 600;
  color: rgba(255, 255, 255, 0.4);
  transition: all 0.3s ease-in-out;
}

.square.occupied .square-content {
  top: 5%;
  left: 7%;
  font-size: calc(var(--square-size) * 0.2); /* Responsive font */
  font-weight: 700;
  color: rgba(255, 255, 255, 0.6);
}

/* === TOKEN CONTAINER & TOKENS - Made Responsive === */
.token-container {
  z-index: 2;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-content: center; 
  align-items: center;
  gap: 3px; /* A small gap between tokens */
  width: 100%;
  height: 100%;
  padding: 2px;
  box-sizing: border-box;
}

.token {
  flex-grow: 0;
  flex-shrink: 1;
  flex-basis: 45%;
  aspect-ratio: 1 / 1;
  max-width: calc(var(--square-size) * 0.5);
  border-radius: 50%;
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  font-size: calc(var(--square-size) * 0.18); /* Responsive font */
  border: 2px solid rgba(0, 0, 0, 0.5);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  transition: all 0.2s ease-in-out;
}
.token.blue { background-color: var(--blue); }
.token.yellow { background-color: var(--yellow); color: #212121; }
.token.green { background-color: var(--green); }
.token.purple { background-color: var(--purple); }
.token.selectable { cursor: pointer; animation: pulse 1.5s infinite; z-index: 20; }

/* Animation (Unchanged) */
@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
  50% { transform: scale(1.2); box-shadow: 0 0 10px 8px rgba(255, 193, 7, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}

/* === OVERLAY UI: QUADRANT SCOREBOARD - Made Responsive === */
.quadrant-scoreboard {
  background-color: #111;
  border-radius: 12px;
  z-index: 10;
  padding: 5%; /* Use percentage for padding */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}
.quadrant-scoreboard.tl { border-color: var(--blue); }
.quadrant-scoreboard.tr { border-color: var(--purple); }
.quadrant-scoreboard.bl { border-color: var(--yellow); }
.quadrant-scoreboard.br { border-color: var(--green); }
.quadrant-scoreboard.current-player { border-width: 0px; padding: calc(5% + 2px); }
.quadrant-scoreboard.current-player.tl { background-color: var(--blue); }
.quadrant-scoreboard.current-player.tr { background-color: var(--purple); }
.quadrant-scoreboard.current-player.br { background-color: var(--green); }
.quadrant-scoreboard.current-player.bl { background-color: var(--yellow); color: #111; }
.quadrant-scoreboard.current-player .player-score,
.quadrant-scoreboard.current-player .player-turns { color: inherit; }
.quadrant-scoreboard.tl { grid-column: 2 / span 2; grid-row: 2 / span 2; }
.quadrant-scoreboard.tr { grid-column: 7 / span 2; grid-row: 2 / span 2; }
.quadrant-scoreboard.bl { grid-column: 2 / span 2; grid-row: 7 / span 2; }
.quadrant-scoreboard.br { grid-column: 7 / span 2; grid-row: 7 / span 2; }
.player-score { font-size: calc(var(--square-size) * 0.5); font-weight: 700; line-height: 1.1; margin: 2px 0; }
.player-turns { font-size: calc(var(--square-size) * 0.18); color: var(--text-muted); }

/* === OVERLAY UI: CONTROL HUB - Made Responsive === */
.control-hub {
  grid-column: 4 / span 3;
  grid-row: 4 / span 3;
  z-index: 10;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.3s ease;
}

.animating-token-wrapper {
  position: absolute;
  z-index: 50;
  width: var(--square-size);   /* Responsive size */
  height: var(--square-size);  /* Responsive size */
  display: flex;
  justify-content: center;
  align-items: center;
  transition: top 0.1s ease-in-out, left 0.1s ease-in-out;
}
.animating-token-wrapper.is-returning .token { opacity: 0.6; transform: scale(0.8); filter: grayscale(50%); }

/* === DICE STYLES - Made Responsive === */
@keyframes pop { 0% { transform: scale(0.8); opacity: 0.8; } 70% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }
@keyframes roll { 0% { transform: rotate(0deg) scale(0.9); } 100% { transform: rotate(360deg) scale(0.9); } }

.dice-face {
  width: calc(var(--square-size) * 1.5);   /* Responsive size */
  height: calc(var(--square-size) * 1.5);  /* Responsive size */
  background-color: #fff;
  border-radius: 12px;
  padding: 10%;
  box-shadow: 0 5px 10px rgba(0,0,0,0.4);
  display: grid;
  grid-template-areas: "a . c" "e g f" "d . b";
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr 1fr;
}
.dice-face.final-result { animation: pop 0.3s ease-out; }
.dice-face.rolling { animation: roll 0.5s infinite linear; }
.pip {
  width: calc(var(--square-size) * 0.25);  /* Responsive size */
  height: calc(var(--square-size) * 0.25); /* Responsive size */
  background-color: #111;
  border-radius: 50%;
  align-self: center;
  justify-self: center;
}
.final-result .pip, .dice-face[style*="color"] .pip { background-color: currentColor; }

/* Pip positioning (Unchanged) */
.dice-face:is([data-number="1"]) .pip:nth-child(1) { grid-area: g; }
.dice-face:is([data-number="2"]) .pip:nth-child(1) { grid-area: a; } .dice-face:is([data-number="2"]) .pip:nth-child(2) { grid-area: b; }
.dice-face:is([data-number="3"]) .pip:nth-child(1) { grid-area: a; } .dice-face:is([data-number="3"]) .pip:nth-child(2) { grid-area: g; } .dice-face:is([data-number="3"]) .pip:nth-child(3) { grid-area: b; }
.dice-face:is([data-number="4"]) .pip:nth-child(1) { grid-area: a; } .dice-face:is([data-number="4"]) .pip:nth-child(2) { grid-area: b; } .dice-face:is([data-number="4"]) .pip:nth-child(3) { grid-area: c; } .dice-face:is([data-number="4"]) .pip:nth-child(4) { grid-area: d; }
.dice-face:is([data-number="5"]) .pip:nth-child(1) { grid-area: a; } .dice-face:is([data-number="5"]) .pip:nth-child(2) { grid-area: b; } .dice-face:is([data-number="5"]) .pip:nth-child(3) { grid-area: c; } .dice-face:is([data-number="5"]) .pip:nth-child(4) { grid-area: d; } .dice-face:is([data-number="5"]) .pip:nth-child(5) { grid-area: g; }
.dice-face:is([data-number="6"]) .pip:nth-child(1) { grid-area: a; } .dice-face:is([data-number="6"]) .pip:nth-child(2) { grid-area: b; } .dice-face:is([data-number="6"]) .pip:nth-child(3) { grid-area: c; } .dice-face:is([data-number="6"]) .pip:nth-child(4) { grid-area: d; } .dice-face:is([data-number="6"]) .pip:nth-child(5) { grid-area: e; } .dice-face:is([data-number="6"]) .pip:nth-child(6) { grid-area: f; }

.clickable-die { cursor: pointer; transition: transform 0.2s ease-out; }
.clickable-die:hover { transform: scale(1.1) rotate(10deg); }
.dice-face.idle { background-color: var(--action-green); opacity: 0.9; }
.dice-face.idle .pip { background-color: rgba(255, 255, 255, 0.8); }
.ai-thinking { font-size: 2rem; font-weight: 700; color: var(--text-muted); opacity: 0.5; }

/* --- Home Icon Styles - Made Responsive --- */
.square-content.home-icon { font-size: initial; font-weight: initial; display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; }
.home-icon svg { width: 50%; height: 50%; opacity: 0.75; transition: all 0.3s ease-in-out; }
.home-icon.blue { color: var(--blue); }
.home-icon.yellow { color: var(--yellow); }
.home-icon.green { color: var(--green); }
.home-icon.purple { color: var(--purple); }
.square.occupied .home-icon svg { transform: scale(0.8); opacity: 0.1; }

/* ========================================================================== */
/* ======================== MEDIA QUERIES FOR RESPONSIVENESS ======================== */
/* ========================================================================== */

/* --- TABLET & LARGE PHONE (Portrait) --- */
@media (max-width: 768px) {
  html {
    font-size: 14px; /* Scale down the base font size */
  }
  :root {
    --square-size: 9.5vmin; /* Make the board fill more of the screen */
  }
  body {
    padding: 0.5rem;
  }
  .app-container {
    gap: 1rem;
  }
  .screen {
    padding: 1.5rem;
    gap: 1.2rem;
  }
}

/* --- SMALL PHONE (Portrait) --- */
@media (max-width: 480px) {
  html {
    font-size: 12px; /* Scale down fonts even more */
  }
  :root {
    --square-size: 10vmin; /* Maximize board size for small screens */
  }
  body {
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
  }
  .mode-selection {
    flex-direction: column; /* Stack the mode buttons vertically */
    width: 100%;
    align-items: stretch; /* Make buttons full width */
  }
  .setting-row {
    flex-direction: column; /* Stack setting label and toggle */
    align-items: flex-start;
  }
  .score-row {
    font-size: 1rem;
    grid-template-columns: 30px 1fr auto;
  }
}

/* --- LANDSCAPE ON MOBILE/TABLET --- */
@media (max-height: 500px) and (orientation: landscape) {
  :root {
    --square-size: 9vh;
  }
  .app-container {
    flex-direction: row; /* Place title next to the board */
    justify-content: center;
    align-items: center;
    gap: 2rem;
  }
  h1 {
    font-size: 2rem;
    writing-mode: vertical-rl;
    text-orientation: mixed;
  }
}

.mode-selection button.active {
  background-color: var(--cyan);
  color: #111;
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.mode-selection.expanded {
  background-color: rgba(0, 0, 0, 0);
  padding: 1rem;
  margin-top: -0.5rem; /* Pull it closer to the button above */
  margin-bottom: 1rem;
  border-radius: 0 0 12px 12px;
}

.mode-selection.expanded button {
  background-color: var(--action-green);
  font-size: 1rem;
}